import{a as r,j as o,B as h,o as y,t as P}from"./@mui-926ab118.js";import{r as i}from"./react-4cc0034d.js";import{J as _}from"./jszip-edafff3e.js";import"./clsx-0839fdbe.js";import"./react-transition-group-dd4db10c.js";import"./@babel-591e0485.js";import"./react-dom-502af1e5.js";import"./scheduler-765c72db.js";import"./@emotion-4d3fcc43.js";import"./hoist-non-react-statics-23d96a9a.js";import"./react-is-e8e5dbb3.js";import"./stylis-79144faa.js";const K=()=>{const[c,b]=i.useState([]),[m,k]=i.useState(""),[u,w]=i.useState(""),[p,C]=i.useState([]),[a,g]=i.useState(null),v=i.useRef(null),x=i.useRef(null),S="https://cors-anywhere.herokuapp.com/",D=async()=>{const e=m.split("T")[0],t=m.split("T")[1],n=u.split("T")[0],l=u.split("T")[1],d=`http://localhost:5000/videos?start_date=${e}&start_time=${t}&end_date=${n}&end_time=${l}`;try{const f=await(await fetch(d)).json();b(f.s3_videos||[]),f.s3_videos.length>0?g(f.s3_videos[0]):b([])}catch(s){console.error("Error fetching videos:",s)}},T=e=>{C(t=>t.includes(e)?t.filter(n=>n!==e):[...t,e])},V=async()=>{const e=new _;for(const t of p)try{const l=await(await fetch(S+t)).blob(),d=t.split("/").pop();e.file(d,l)}catch(n){console.error("Error downloading video:",n)}e.generateAsync({type:"blob"}).then(t=>{const n=document.createElement("a");n.href=URL.createObjectURL(t),n.download="videos.zip",document.body.appendChild(n),n.click(),document.body.removeChild(n)})},N=()=>{const e=c.indexOf(a);e!==-1&&e<c.length-1&&g(c[e+1])},E=e=>{g(e)};return r("div",{className:"flex min-h-screen bg-white",children:[r("div",{className:"w-[70%] flex flex-col items-center justify-center text-gray-500 text-lg bg-gray-200",children:[o("h1",{className:"mb-4 text-xl font-semibold",children:" Playback Video Player"}),o("div",{children:a?o("video",{ref:v,width:"1020",height:"720",controls:!0,autoPlay:!0,muted:!0,crossOrigin:"anonymous",src:a,onEnded:N}):o("p",{className:"text-gray-500",children:"Click on a video to play it."})}),a&&o(h,{variant:"contained",color:"secondary",sx:{marginTop:"10px",backgroundColor:"#1976d2",color:"white",height:"48px","&:hover":{backgroundColor:"#1565c0"}},onClick:()=>{if(a){const e=document.createElement("a");e.href=a,e.download=a.split("/").pop(),e.click()}},children:"Download Video"})]}),r("div",{className:"w-[30%] p-8 space-y-6 bg-gray-100",children:[r("div",{children:[o("label",{className:"block text-gray-700 font-medium mb-2",children:"Start Date Time:"}),o(y,{type:"datetime-local",value:m,onChange:e=>k(e.target.value),variant:"outlined",fullWidth:!0,InputLabelProps:{shrink:!0},sx:{backgroundColor:"#f0f0f0"}})]}),r("div",{children:[o("label",{className:"block text-gray-700 font-medium mb-2",children:"End Date Time:"}),o(y,{type:"datetime-local",value:u,onChange:e=>w(e.target.value),variant:"outlined",fullWidth:!0,InputLabelProps:{shrink:!0},sx:{backgroundColor:"#f0f0f0"}})]}),o(h,{variant:"contained",color:"primary",fullWidth:!0,sx:{backgroundColor:"#1976d2",color:"white",height:"48px","&:hover":{backgroundColor:"#1565c0"}},onClick:D,children:"SHOW VIDEO"}),o(h,{variant:"contained",color:"primary",fullWidth:!0,sx:{backgroundColor:"#1976d2",color:"white",height:"48px","&:hover":{backgroundColor:"#1565c0"}},onClick:()=>{const e=v.current,t=x.current;if(e&&t){const n=t.getContext("2d");if(e.readyState===4){t.width=e.videoWidth,t.height=e.videoHeight,n.drawImage(e,0,0,t.width,t.height);const l=t.toDataURL("image/png"),d=new Date().toLocaleString().replace(/[/: ]/g,"_"),s=document.createElement("a");s.href=l,s.download=`snapshot_${d}.png`,s.click()}else console.error("Video is not ready for snapshot")}},children:"TAKE SNAPSHOT"}),r("div",{children:[o("h2",{className:"text-lg font-semibold text-gray-700",children:"Recorded Videos"}),o("ul",{id:"s3-video-list",className:"mt-4 space-y-2",children:c.length>0?c.map((e,t)=>r("li",{children:[o(P,{checked:p.includes(e),onChange:()=>T(e)}),o("button",{className:"text-blue-500 underline",onClick:()=>E(e),children:e.split("/").pop()})]},t)):o("li",{className:"text-gray-500",children:"No videos found for the selected date range."})}),p.length>0&&o(h,{variant:"contained",fullWidth:!0,onClick:V,sx:{backgroundColor:"#1976d2",color:"white",height:"48px","&:hover":{backgroundColor:"#1565c0"}},children:"Download Selected Videos as ZIP"})]})]}),o("canvas",{ref:x,style:{display:"none"}})]})};export{K as default};
